# 图片转GP文件需求文档

## 介绍

本功能旨在实现将一组带有下标的标准程序输出乐谱图片自动转换为GP（Guitar Pro）文件格式。该功能将通过传统图像处理技术识别多张有序乐谱图片中的音乐元素，优先支持六线谱、简谱和歌词识别，并将其转换为现有score工程的数据结构，最终输出为完整的GP文件。

## 需求

### 需求 1

**用户故事：** 作为吉他手，我希望能够上传一组带有下标的六线谱图片，系统能够按顺序识别并转换为完整的GP文件，这样我就可以直接在Guitar Pro软件中编辑和播放整首曲子。

#### 验收标准

1. WHEN 用户上传一组带有下标的六线谱图片 THEN 系统应当能够按下标顺序处理每张图片
2. WHEN 每张图片包含六线谱 THEN 系统应当能够识别出六条线和对应的弦位
3. WHEN 图片包含品位数字（0-24）THEN 系统应当正确识别数字并映射到对应的弦和品位
4. WHEN 所有图片识别完成后 THEN 系统应当将多张图片的内容合并生成完整的GP文件

### 需求 2

**用户故事：** 作为音乐爱好者，我希望系统能够识别图片中的简谱，这样我就可以将简谱转换为GP文件进行播放和学习。

#### 验收标准

1. WHEN 用户上传一张包含简谱的图片 THEN 系统应当能够识别出数字音符（1、2、3、4、5、6、7）
2. WHEN 图片包含高低音点标记 THEN 系统应当正确识别音符的八度信息
3. WHEN 图片包含时值线和附点 THEN 系统应当正确识别音符的时值
4. WHEN 图片包含调号标记（如1=C、1=G等）THEN 系统应当正确识别简谱的调性

### 需求 3

**用户故事：** 作为歌手，我希望系统能够识别图片中的歌词文字，这样转换后的GP文件能够包含完整的歌词信息。

#### 验收标准

1. WHEN 图片包含歌词文字 THEN 系统应当能够识别出中文和英文歌词
2. WHEN 歌词与音符对应 THEN 系统应当正确建立歌词和音符的位置关系
3. WHEN 歌词包含多段 THEN 系统应当能够区分不同段落的歌词
4. WHEN 识别完成后 THEN 系统应当将歌词信息正确存储到Score的TextItem中

### 需求 4

**用户故事：** 作为音乐教师，我希望系统能够识别图片中的小节线和重复记号，这样学生可以获得完整的乐谱结构信息。

#### 验收标准

1. WHEN 图片包含单小节线 THEN 系统应当正确识别并标记小节边界
2. WHEN 图片包含重复开始记号 THEN 系统应当在对应位置创建重复开始标记
3. WHEN 图片包含重复结束记号 THEN 系统应当在对应位置创建重复结束标记
4. WHEN 图片包含段落反复记号（1.、2.等）THEN 系统应当正确识别段落编号

### 需求 5

**用户故事：** 作为作曲家，我希望系统能够识别图片中的和弦标记和调号拍号信息，这样我可以在GP文件中看到完整的音乐信息。

#### 验收标准

1. WHEN 图片包含和弦标记文字（如Am、C7、Fmaj7等）THEN 系统应当正确识别和弦名称
2. WHEN 图片包含调号（升号或降号）THEN 系统应当正确识别调号的数量和类型
3. WHEN 图片包含拍号（如4/4、3/4等）THEN 系统应当正确识别分子和分母数值
4. WHEN 识别到和弦标记 THEN 系统应当在对应位置创建ChordText对象

### 需求 6

**用户故事：** 作为软件用户，我希望系统具有良好的错误处理机制和数据输出功能，确保转换过程稳定可靠。

#### 验收标准

1. WHEN 上传的图片格式不支持 THEN 系统应当显示"不支持的图片格式"错误信息
2. WHEN 图片组中缺少下标或下标不连续 THEN 系统应当显示"图片下标不完整，请确保图片按顺序命名"提示
3. WHEN 图片中无法识别出有效乐谱内容 THEN 系统应当显示"未检测到有效的乐谱内容"提示
4. WHEN 多张图片识别完成 THEN 系统应当生成完整的Score对象，将所有图片内容按顺序合并到正确的System、Staff、Voice、Position和Note层次结构中
5. WHEN 需要输出GP文件 THEN 系统应当调用现有的GP格式转换接口，生成能够在Guitar Pro软件中正常打开的完整文件