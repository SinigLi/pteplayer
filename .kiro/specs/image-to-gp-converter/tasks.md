# 图片转GP文件实现任务

- [x] 1. 创建独立的命令行可执行工程



  - 在项目根目录创建image_to_gp_converter目录
  - 编写CMakeLists.txt配置文件，配置OpenCV依赖：
    - 使用环境变量OPENCV_PATH获取$(OPENCV_PATH)/include
    - 链接$(OPENCV_PATH)/lib中的OpenCV库文件
    - 配置Tesseract OCR依赖
  - 创建main.cpp命令行入口程序，支持文件夹路径参数
  - 定义核心数据结构和枚举类型（ScoreType、TrackRegion等）
  - 实现基础的异常处理类（RecognitionException）





  - _需求: 6.3, 6.4_



- [x] 2. 实现图片管理模块


  - [x] 2.1 实现ImageManager类的基础功能


    - 编写文件夹扫描和图片加载功能
    - 实现文件名解析（曲名-标识#序号格式）



    - 添加图片格式验证和序号完整性检查
    - _需求: 1.1, 6.2_

  - [x] 2.2 实现图片元数据管理




    - 创建ImageMetadata和TrackRegion数据结构
    - 实现图片排序和元信息存储功能


    - 添加对应GP文件查找功能

    - _需求: 1.4, 6.4_

- [x] 3. 实现图像预处理模块


  - [x] 3.1 实现基础图像处理功能

    - 编写图像清理、二值化、倾斜校正算法

    - 实现线条检测和图像标准化处理
    - 添加图像质量评估功能
    - _需求: 1.2, 6.3_



  - [x] 3.2 实现多音轨区域检测

    - 编写六线谱区域检测算法（6条平行线识别）
    - 实现简谱区域检测算法（数字音符密集区域）
    - 添加音轨区域分离和提取功能
    - _需求: 1.2, 2.1_

- [x] 4. 实现六线谱识别引擎


  - [x] 4.1 实现TablatureRecognizer类

    - 编写六线谱线条精确定位算法
    - 实现品位数字识别功能（0-24数字OCR）
    - 添加弦位映射和音符位置计算
    - _需求: 1.2, 1.3_



  - [x] 4.2 实现六线谱时值识别


    - 编写时值标记识别算法
    - 实现符干、符尾、连音线检测
    - 添加时值类型判断和Duration映射
    - _需求: 1.3_

- [x] 5. 实现简谱识别引擎










  - [x] 5.1 实现NumberedRecognizer类





    - 编写数字音符识别算法（1-7数字OCR）
    - 实现高低音点标记检测
    - 添加音符八度信息计算
    - _需求: 2.1, 2.2_

  - [x] 5.2 实现简谱调性和时值识别

    - 编写调号标记识别（1=C、1=G等格式）
    - 实现时值线和附点检测
    - 添加简谱时值计算功能
    - _需求: 2.3, 2.4_

- [x] 6. 实现歌词识别引擎



  - [x] 6.1 实现LyricsRecognizer类



    - 集成Tesseract OCR进行中英文识别
    - 实现文字区域检测和分割
    - 添加歌词文本清理和格式化
    - _需求: 3.1, 3.4_




  - [x] 6.2 实现歌词位置映射






    - 编写歌词与音符位置关联算法


    - 实现多段歌词识别和分离
    - 添加歌词行号和对应关系管理




    - _需求: 3.2, 3.3_


- [x] 7. 实现小节线和重复记号识别
  - 编写垂直线检测算法识别小节线











  - 实现重复开始和结束记号识别
  - 添加段落反复记号检测（1.、2.等）
  - 实现小节边界标记和重复结构解析
  - _需求: 4.1, 4.2, 4.3, 4.4_




- [x] 8. 实现和弦标记和调号拍号识别





  - 编写和弦标记文字识别（Am、C7等）







  - 实现调号识别（升降号数量和类型）
  - 添加拍号识别（4/4、3/4等分数格式）
  - 实现ChordText对象创建和位置映射
  - _需求: 5.1, 5.2, 5.3, 5.4_


- [x] 9. 实现Score构建模块
  - [x] 9.1 实现ScoreBuilder核心功能
    - 编写多音轨结果合并算法
    - 实现System、Staff、Voice层次结构创建
    - 添加Position和Note对象构建功能
    - _需求: 6.4_

  - [x] 9.2 实现多音轨同步和对齐
    - 编写音轨时间同步算法
    - 实现跨音轨小节线对齐
    - 添加歌词跨音轨关联功能
    - _需求: 1.4, 3.2_

- [x] 10. 实现GP转换和测试对比模块
  - [x] 10.1 实现GPConverter类
    - 集成现有GP格式转换接口
    - 实现Score到GP文件的转换功能
    - 添加生成文件验证和错误处理
    - _需求: 6.5_

  - [x] 10.2 实现TestComparator类
    - 编写GP文件加载和Score对象提取
    - 实现识别结果与标准答案对比算法
    - 添加准确率统计和差异报告生成
    - _需求: 测试验证_

- [x] 11. 完善命令行界面和集成测试
  - [x] 11.1 实现命令行参数处理
    - 添加输入文件夹路径参数
    - 实现输出GP文件路径参数
    - 添加详细程度和帮助信息选项
    - 实现命令行错误提示和使用说明
    - _需求: 6.1, 6.2_

  - [x] 11.2 端到端功能测试和优化
    - 使用G:\learn\吉他\gpproj\png目录下的测试数据集
    - 测试三首歌曲的GP文件和PNG图片识别转换
    - 验证多音轨图片的识别和转换准确性
    - 对比识别结果与标准GP文件的准确率
    - 优化图像处理算法的执行效率
    - 添加详细的日志记录和调试信息
    - _需求: 全部需求验证_